<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant d'Entretien</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" href="icon-32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="icon-16.png" sizes="16x16">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Empêcher le zoom sur les inputs en mobile */
        input, select, textarea {
            font-size: 16px!important;
        }
        
        /* Style pour une meilleure expérience mobile */
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Empêcher la sélection de texte accidentelle */
       .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icônes SVG ---
        const Bell = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="m13.73 21a2 2 0 0 1-3.46 0"/></svg>);
        const Plus = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>);
        const ArrowLeft = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>);
        const Wrench = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>);
        const Car = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 10c-.4-.8-1.2-1.3-2.1-1.3H7.7c-.9 0-1.7.5-2.1 1.3L3.5 11.1C2.7 11.3 2 12.1 2 13v3c0.6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></svg>);
        const Home = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>);
        const History = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>);
        const CheckCircle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>);
        const Clock = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>);
        const AlertTriangle = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="m12 17.02.01 0"/></svg>);
        const Edit = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>);
        const Trash2 = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>);
        const CalendarClock = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5"/><path d="M16 2v4"/><path d="M8 2v4"/><path d="M3 10h18"/><circle cx="18" cy="18" r="4"/><path d="M18 16v2l1 1"/></svg>);
        const ChefHat = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22c-2.5 0-2.5-2-5-2-2.5 0-2.5 2-5 2v-2c0-2.5 2.5-2.5 5-5 2.5 0 2.5 2.5 5 5Z"/><path d="M12 22c2.5 0 2.5-2 5-2 2.5 0 2.5 2 5 2v-2c0-2.5-2.5-2.5-5-5-2.5 0-2.5 2.5-5 5Z"/><path d="M12 15c-2.5 0-2.5-2-5-2-2.5 0-2.5 2-5 2V7c0-2.5 2.5-2.5 5-5 2.5 0 2.5 2.5 5 5Z"/><path d="M12 15c2.5 0 2.5-2 5-2 2.5 0 2.5 2 5 2V7c0-2.5-2.5-2.5-5-5-2.5 0-2.5 2.5-5 5Z"/></svg>);
        const Bed = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 4v16h20V4Z"/><path d="M2 10h20"/><path d="M6 14v-4"/><path d="M18 14v-4"/></svg>);
        const Bath = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 6 6.5 3.5a1.5 1.5 0 0 0-2.12 0L3 4.88a1.5 1.5 0 0 0 0 2.12L4 8"/><path d="M9 12H3.5a2.5 2.5 0 0 1-2.5-2.5V8"/><path d="M14 14V5a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v3h2"/><path d="M8 15h12v5a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2v-5Z"/><path d="M21.5 15a2.5 2.5 0 0 0-2.5-2.5H17v2.5"/></svg>);
        const Sun = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m4.93 19.07 1.41-1.41"/><path d="m17.66 6.34 1.41-1.41"/></svg>);
        const Briefcase = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>);

        const MobileMaintenanceApp = () => {
            const [items, setItems] = useState(() => {
                const saved = localStorage.getItem('maintenanceItems');
                return saved? JSON.parse(saved) :;
            });

            const [currentView, setCurrentView] = useState('list'); // 'list', 'add', 'edit', 'history'
            const = useState('today'); // 'today', 'upcoming', 'completed_today'
            const [editingItem, setEditingItem] = useState(null);
            const [justCompleted, setJustCompleted] = useState(null);
            const = useState(null);

            useEffect(() => {
                localStorage.setItem('maintenanceItems', JSON.stringify(items));
            }, [items]);

            const categories = {
                cuisine: { icon: ChefHat, label: 'Cuisine', bgClass: 'bg-orange-100', textClass: 'text-orange-600' },
                sdb: { icon: Bath, label: 'Salle de bain', bgClass: 'bg-cyan-100', textClass: 'text-cyan-600' },
                chambre: { icon: Bed, label: 'Chambre', bgClass: 'bg-violet-100', textClass: 'text-violet-600' },
                maison: { icon: Home, label: 'Maison', bgClass: 'bg-purple-100', textClass: 'text-purple-600' },
                electromenager: { icon: Wrench, label: 'Électroménager', bgClass: 'bg-blue-100', textClass: 'text-blue-600' },
                voiture: { icon: Car, label: 'Voiture', bgClass: 'bg-green-100', textClass: 'text-green-600' },
                exterieur: { icon: Sun, label: 'Extérieur', bgClass: 'bg-yellow-100', textClass: 'text-yellow-600' },
                bureau: { icon: Briefcase, label: 'Bureau', bgClass: 'bg-indigo-100', textClass: 'text-indigo-600' },
                autres: { icon: Bell, label: 'Autres', bgClass: 'bg-gray-100', textClass: 'text-gray-600' },
            };

            const [newItem, setNewItem] = useState({
                name: '',
                category: 'cuisine',
                lastMaintenance: '',
                intervalDays: '',
                notes: ''
            });

            const getNextMaintenanceDate = (lastDate, intervalDays) => {
                if (!lastDate ||!intervalDays) return null;
                const last = new Date(lastDate);
                const next = new Date(last);
                next.setDate(last.getDate() + parseInt(intervalDays));
                return next;
            };

            const getStatus = (nextDate) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const next = new Date(nextDate);
                next.setHours(0, 0, 0, 0);
                
                const diffDays = Math.ceil((next - today) / (1000 * 60 * 60 * 24));
                
                if (diffDays < 0) return 'overdue';
                if (diffDays === 0) return 'today';
                if (diffDays <= 7) return 'urgent';
                if (diffDays <= 30) return 'soon';
                return 'ok';
            };

            const addItem = () => {
                if (!newItem.name ||!newItem.lastMaintenance ||!newItem.intervalDays) return;
                const nextMaintenanceDate = getNextMaintenanceDate(newItem.lastMaintenance, newItem.intervalDays);
                const item = {
                    id: Date.now(),
                   ...newItem,
                    intervalDays: parseInt(newItem.intervalDays),
                    nextMaintenance: nextMaintenanceDate? nextMaintenanceDate.toISOString() : null,
                    history:
                };
                setItems([...items, item]);
                setNewItem({ name: '', category: 'cuisine', lastMaintenance: '', intervalDays: '', notes: '' });
                setCurrentView('list');
            };

            const startEdit = (item) => {
                setEditingItem({
                   ...item,
                    lastMaintenance: new Date(item.lastMaintenance).toISOString().split('T'),
                });
                setCurrentView('edit');
            };

            const saveEdit = () => {
                if (!editingItem.name ||!editingItem.lastMaintenance ||!editingItem.intervalDays) return;
                const nextMaintenanceDate = getNextMaintenanceDate(editingItem.lastMaintenance, editingItem.intervalDays);
                const updatedItem = {
                   ...editingItem,
                    intervalDays: parseInt(editingItem.intervalDays),
                    nextMaintenance: nextMaintenanceDate? nextMaintenanceDate.toISOString() : null,
                };
                setItems(items.map(item => item.id === editingItem.id? updatedItem : item));
                setEditingItem(null);
                setCurrentView('list');
            };

            const markAsDone = (id) => {
                setItems(items.map(item => {
                    if (item.id === id) {
                        const now = new Date();
                        const completionRecord = {
                            date: now.toISOString(),
                            notes: '' // Could add a field for completion notes later
                        };
                        const updatedHistory = item.history? :;
                        
                        const updatedItem = {
                           ...item,
                            lastMaintenance: now.toISOString(),
                            nextMaintenance: getNextMaintenanceDate(now, item.intervalDays).toISOString(),
                            history: updatedHistory
                        };
                        
                        setJustCompleted(id);
                        setTimeout(() => setJustCompleted(null), 2000);
                        
                        return updatedItem;
                    }
                    return item;
                }));
            };

            const deleteItem = (id) => {
                setItems(items.filter(item => item.id!== id));
                setShowDeleteConfirm(null);
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'overdue': return 'border-red-500';
                    case 'today': return 'border-red-500';
                    case 'urgent': return 'border-orange-500';
                    case 'soon': return 'border-yellow-500';
                    default: return 'border-green-500';
                }
            };

            const getStatusText = (status, nextDate) => {
                const today = new Date();
                today.setHours(0,0,0,0);
                const next = new Date(nextDate);
                next.setHours(0,0,0,0);

                const diffDays = Math.ceil((next - today) / (1000 * 60 * 60 * 24));
                
                switch (status) {
                    case 'overdue': return `Retard de ${Math.abs(diffDays)}j`;
                    case 'today': return `Aujourd'hui`;
                    case 'urgent': return `Dans ${diffDays}j`;
                    case 'soon': return `Dans ${diffDays}j`;
                    default: return `Dans ${diffDays}j`;
                }
            };
            
            const todayString = new Date().toISOString().split('T');

            const isCompletedToday = (item) => {
                if (!item.history |

| item.history.length === 0) return false;
                const lastCompletionDate = new Date(item.history[item.history.length - 1].date).toISOString().split('T');
                return lastCompletionDate === todayString;
            };

            const itemsToday = useMemo(() => items.filter(item => {
                const status = getStatus(item.nextMaintenance);
                return (status === 'today' |

| status === 'overdue') &&!isCompletedToday(item);
            }).sort((a, b) => new Date(a.nextMaintenance) - new Date(b.nextMaintenance)), [items]);
            
            const itemsUpcoming = useMemo(() => items.filter(item => {
                const status = getStatus(item.nextMaintenance);
                return (status === 'urgent' |

| status === 'soon' |
| status === 'ok') &&!isCompletedToday(item);
            }).sort((a, b) => new Date(a.nextMaintenance) - new Date(b.nextMaintenance)), [items]);

            const itemsCompletedToday = useMemo(() => items.filter(isCompletedToday)
             .sort((a, b) => new Date(b.history[b.history.length-1].date) - new Date(a.history[a.history.length-1].date)), [items]);

            const allCompletedItems = useMemo(() => {
                const allHistory =;
                items.forEach(item => {
                    if (item.history && item.history.length > 0) {
                        item.history.forEach(h => {
                            allHistory.push({...item, completionDate: h.date });
                        });
                    }
                });
                return allHistory.sort((a, b) => new Date(b.completionDate) - new Date(a.completionDate));
            }, [items]);

            const ItemCard = ({ item }) => {
                const category = categories[item.category] |

| categories['autres'];
                const status = getStatus(item.nextMaintenance);
                const IconComponent = category.icon;

                return (
                    <div className={`bg-white rounded-lg shadow-md border-l-4 ${getStatusColor(status)} ${justCompleted === item.id? 'ring-2 ring-green-300 bg-green-50' : ''}`}>
                        <div className="p-4">
                            <div className="flex items-start justify-between mb-3">
                                <div className="flex items-center gap-3 flex-1 min-w-0">
                                    <div className={`p-2 rounded-lg ${category.bgClass}`}>
                                        <IconComponent />
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <h3 className="font-semibold text-gray-800 truncate">{item.name}</h3>
                                        <p className="text-sm text-gray-500">{category.label}</p>
                                    </div>
                                </div>
                                <div className="flex gap-1 ml-2">
                                    <button onClick={() => startEdit(item)} className="p-2 text-gray-400 hover:text-blue-500 hover:bg-blue-50 rounded-lg"><Edit /></button>
                                    <button onClick={() => setShowDeleteConfirm(item.id)} className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg"><Trash2 /></button>
                                </div>
                            </div>
                            <div className="space-y-1 text-sm text-gray-600 mb-4">
                                <p><span className="font-medium">Prochain:</span> {getStatusText(status, item.nextMaintenance)} ({new Date(item.nextMaintenance).toLocaleDateString('fr-FR')})</p>
                                <p><span className="font-medium">Dernier:</span> {new Date(item.lastMaintenance).toLocaleDateString('fr-FR')}</p>
                                {item.notes && <p className="text-xs pt-1"><span className="font-medium">Notes:</span> {item.notes}</p>}
                            </div>
                            <button
                                onClick={() => markAsDone(item.id)}
                                className={`w-full px-4 py-3 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-medium ${justCompleted === item.id? 'bg-green-700 text-white' : 'bg-green-600 text-white hover:bg-green-700 active:bg-green-800'}`}
                                disabled={justCompleted === item.id}
                            >
                                <CheckCircle />
                                {justCompleted === item.id? 'Terminé!' : 'Marquer comme fait'}
                            </button>
                        </div>
                    </div>
                );
            };
            
            const CompletedItemCard = ({ item }) => {
                const category = categories[item.category] |

| categories['autres'];
                const IconComponent = category.icon;
                const completedDate = new Date(item.completionDate);
                return (
                    <div className="bg-white rounded-lg shadow-md border-l-4 border-green-500 p-4">
                        <div className="flex items-center gap-3 mb-2">
                            <div className={`p-2 rounded-lg ${category.bgClass}`}><IconComponent /></div>
                            <div>
                                <h3 className="font-semibold text-gray-800">{item.name}</h3>
                                <p className="text-sm text-gray-600 flex items-center gap-1">
                                    <CheckCircle className="w-4 h-4 text-green-600" /> Fait le{' '}
                                    <span className="font-medium">
                                        {completedDate.toLocaleDateString('fr-FR')} à {completedDate.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                );
            };

            const FormView = ({ item, onSave, isEdit }) => {
                const = useState(item);

                const handleChange = (e) => {
                    setFormData({...formData, [e.target.name]: e.target.value });
                };

                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSave(formData);
                };

                return (
                    <form onSubmit={handleSubmit} className="p-4 space-y-4">
                        <h2 className="text-xl font-bold text-gray-800">{isEdit? "Modifier l'élément" : "Ajouter un nouvel élément"}</h2>
                        <div>
                            <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                            <input type="text" name="name" value={formData.name} onChange={handleChange} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3" placeholder="Ex: Vidange voiture" required />
                        </div>
                        <div>
                            <label htmlFor="category" className="block text-sm font-medium text-gray-700 mb-1">Catégorie</label>
                            <select name="category" value={formData.category} onChange={handleChange} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3">
                                {Object.entries(categories).map(([key, cat]) => <option key={key} value={key}>{cat.label}</option>)}
                            </select>
                        </div>
                        <div>
                            <label htmlFor="lastMaintenance" className="block text-sm font-medium text-gray-700 mb-1">Dernier Entretien</label>
                            <input type="date" name="lastMaintenance" value={formData.lastMaintenance} onChange={handleChange} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3" required />
                        </div>
                        <div>
                            <label htmlFor="intervalDays" className="block text-sm font-medium text-gray-700 mb-1">Fréquence (jours)</label>
                            <input type="number" name="intervalDays" value={formData.intervalDays} onChange={handleChange} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3" placeholder="Ex: 365 pour 1 an" required />
                        </div>
                        <div>
                            <label htmlFor="notes" className="block text-sm font-medium text-gray-700 mb-1">Notes (optionnel)</label>
                            <textarea name="notes" value={formData.notes} onChange={handleChange} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 h-24" placeholder="Détails importants..."></textarea>
                        </div>
                        <button type="submit" className="w-full bg-blue-600 text-white p-3 rounded-lg font-medium hover:bg-blue-700">
                            {isEdit? "Enregistrer" : "Ajouter"}
                        </button>
                    </form>
                );
            };

            const renderContent = () => {
                if (currentView === 'add') {
                    return <FormView item={newItem} onSave={addItem} isEdit={false} />;
                }
                if (currentView === 'edit' && editingItem) {
                    return <FormView item={editingItem} onSave={saveEdit} isEdit={true} />;
                }
                if (currentView === 'history') {
                    return (
                        <div className="p-4 space-y-4">
                            {allCompletedItems.length === 0? (
                                <div className="text-center py-12">
                                    <History className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                                    <p className="text-gray-500 text-lg">L'historique est vide</p>
                                </div>
                            ) : (
                                allCompletedItems.map(item => <CompletedItemCard key={`${item.id}-${item.completionDate}`} item={item} />)
                            )}
                        </div>
                    );
                }
                // Default is 'list' view
                return (
                    <>
                        <div className="border-b border-gray-200 sticky top-16 bg-gray-50 z-40">
                            <nav className="-mb-px flex justify-around" aria-label="Tabs">
                                <button onClick={() => setActiveTab('today')} className={`w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm ${activeTab === 'today'? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>
                                    Aujourd'hui {itemsToday.length > 0 && `(${itemsToday.length})`}
                                </button>
                                <button onClick={() => setActiveTab('upcoming')} className={`w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm ${activeTab === 'upcoming'? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>
                                    À prévoir
                                </button>
                                <button onClick={() => setActiveTab('completed_today')} className={`w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm ${activeTab === 'completed_today'? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>
                                    Fait {itemsCompletedToday.length > 0 && `(${itemsCompletedToday.length})`}
                                </button>
                            </nav>
                        </div>
                        <div className="p-4 space-y-4">
                            {activeTab === 'today' && (
                                itemsToday.length === 0? <div className="text-center py-12 text-gray-500">Rien à faire aujourd'hui!</div> : itemsToday.map(item => <ItemCard key={item.id} item={item} />)
                            )}
                            {activeTab === 'upcoming' && (
                                itemsUpcoming.length === 0? <div className="text-center py-12 text-gray-500">Aucune tâche à prévoir.</div> : itemsUpcoming.map(item => <ItemCard key={item.id} item={item} />)
                            )}
                            {activeTab === 'completed_today' && (
                                itemsCompletedToday.length === 0? <div className="text-center py-12 text-gray-500">Aucune tâche terminée aujourd'hui.</div> : itemsCompletedToday.map(item => <CompletedItemCard key={item.id} item={{...item, completionDate: item.history[item.history.length-1].date}} />)
                            )}
                        </div>
                    </>
                );
            };

            return (
                <div className="max-w-md mx-auto bg-gray-50 min-h-screen flex flex-col">
                    <div className="bg-blue-600 text-white p-4 flex items-center justify-between sticky top-0 z-50">
                        <div className="flex items-center gap-3">
                            {currentView!== 'list' && (
                                <button onClick={() => setCurrentView('list')} className="p-1"><ArrowLeft /></button>
                            )}
                            <h1 className="text-lg font-semibold">
                                {currentView === 'add'? 'Ajouter' : currentView === 'edit'? 'Modifier' : currentView === 'history'? 'Historique' : 'Assistant d\'Entretien'}
                            </h1>
                        </div>
                        {currentView === 'list' && (
                            <button onClick={() => setCurrentView('add')} className="p-2 hover:bg-blue-700 rounded-lg"><Plus /></button>
                        )}
                    </div>

                    <div className="flex-grow overflow-y-auto pb-20">
                        {renderContent()}
                    </div>

                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
                                <h3 className="text-lg font-bold text-gray-900 mb-4">Confirmer la suppression</h3>
                                <p className="text-gray-600 mb-6">Êtes-vous sûr de vouloir supprimer "{items.find(item => item.id === showDeleteConfirm)?.name}"?</p>
                                <div className="flex justify-end space-x-3">
                                    <button onClick={() => setShowDeleteConfirm(null)} className="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Annuler</button>
                                    <button onClick={() => deleteItem(showDeleteConfirm)} className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Supprimer</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="bg-white border-t border-gray-200 p-3 flex justify-around items-center sticky bottom-0 w-full max-w-md mx-auto z-50">
                        <button onClick={() => setCurrentView('list')} className={`flex flex-col items-center p-2 rounded-lg transition-colors ${currentView === 'list'? 'text-blue-600' : 'text-gray-500'}`}>
                            <CalendarClock className="w-6 h-6" />
                            <span className="text-xs mt-1">À faire</span>
                        </button>
                        <button onClick={() => setCurrentView('history')} className={`flex flex-col items-center p-2 rounded-lg transition-colors ${currentView === 'history'? 'text-blue-600' : 'text-gray-500'}`}>
                            <History className="w-6 h-6" />
                            <span className="text-xs mt-1">Historique</span>
                        </button>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<MobileMaintenanceApp />, document.getElementById('root'));

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                   .then(registration => console.log('Service Worker enregistré:', registration))
                   .catch(error => console.error('Échec enregistrement SW:', error));
            });
        }
    </script>
</body>
</html>
