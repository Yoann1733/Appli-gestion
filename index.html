<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant d'Entretien</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Empêcher le zoom sur les inputs en mobile */
        input, select, textarea {
            font-size: 16px !important;
        }
        
        /* Style pour une meilleure expérience mobile */
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Empêcher la sélection de texte accidentelle */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        
        // Icônes Lucide simulées avec SVG
        const Bell = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
                <path d="m13.73 21a2 2 0 0 1-3.46 0"/>
            </svg>
        );
        
        const Plus = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
            </svg>
        );
        
        const ArrowLeft = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="m12 19-7-7 7-7"/><path d="M19 12H5"/>
            </svg>
        );
        
        const Filter = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"/>
            </svg>
        );
        
        const Wrench = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
        );
        
        const Car = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 10c-.4-.8-1.2-1.3-2.1-1.3H7.7c-.9 0-1.7.5-2.1 1.3L3.5 11.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2"/>
                <circle cx="7" cy="17" r="2"/>
                <path d="M9 17h6"/>
                <circle cx="17" cy="17" r="2"/>
            </svg>
        );
        
        const Flower = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 7.5a4.5 4.5 0 1 1 4.5 4.5M12 7.5A4.5 4.5 0 1 0 7.5 12M12 7.5V9a3 3 0 0 0 3 3h1.5M12 7.5V9a3 3 0 0 1-3 3H7.5"/>
                <path d="M12 16.5V21"/>
                <path d="M8 18h8"/>
            </svg>
        );
        
        const CheckCircle = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
        );
        
        const Clock = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
            </svg>
        );
        
        const AlertTriangle = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                <path d="M12 9v4"/>
                <path d="m12 17.02.01 0"/>
            </svg>
        );
        
        const Edit = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );
        
        const Trash2 = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 6h18"/>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                <line x1="10" x2="10" y1="11" y2="17"/>
                <line x1="14" x2="14" y1="11" y2="17"/>
            </svg>
        );

        const MobileMaintenanceApp = () => {
          const [items, setItems] = useState(() => {
            const saved = localStorage.getItem('maintenanceItems');
            return saved ? JSON.parse(saved) : [];
          });
          const [currentView, setCurrentView] = useState('list');
          const [editingItem, setEditingItem] = useState(null);
          const [filter, setFilter] = useState('all');
          const [justCompleted, setJustCompleted] = useState(null);
          const [showDeleteConfirm, setShowDeleteConfirm] = useState(null);

          // Sauvegarder dans localStorage à chaque modification
          React.useEffect(() => {
            localStorage.setItem('maintenanceItems', JSON.stringify(items));
          }, [items]);

          const categories = {
            electromenager: { 
              icon: Wrench, 
              color: 'blue', 
              label: 'Électroménager',
              bgClass: 'bg-blue-100',
              textClass: 'text-blue-600'
            },
            voiture: { 
              icon: Car, 
              color: 'green', 
              label: 'Voiture',
              bgClass: 'bg-green-100',
              textClass: 'text-green-600'
            },
            plantes: { 
              icon: Flower, 
              color: 'pink', 
              label: 'Plantes',
              bgClass: 'bg-pink-100',
              textClass: 'text-pink-600'
            },
          };

          const [newItem, setNewItem] = useState({
            name: '',
            category: 'electromenager',
            lastMaintenance: '',
            intervalDays: '',
            notes: ''
          });

          const getNextMaintenanceDate = (lastDate, intervalDays) => {
            const last = new Date(lastDate);
            const next = new Date(last);
            next.setDate(last.getDate() + parseInt(intervalDays));
            return next;
          };

          const getStatus = (nextDate) => {
            const today = new Date();
            const diffDays = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) return 'overdue';
            if (diffDays <= 7) return 'urgent';
            if (diffDays <= 30) return 'soon';
            return 'ok';
          };

          const addItem = () => {
            if (!newItem.name || !newItem.lastMaintenance || !newItem.intervalDays) return;

            const item = {
              id: Date.now(),
              ...newItem,
              intervalDays: parseInt(newItem.intervalDays),
              nextMaintenance: getNextMaintenanceDate(newItem.lastMaintenance, newItem.intervalDays)
            };

            setItems([...items, item]);
            setNewItem({ name: '', category: 'electromenager', lastMaintenance: '', intervalDays: '', notes: '' });
            setCurrentView('list');
          };

          const startEdit = (item) => {
            setEditingItem({
              ...item,
              lastMaintenance: item.lastMaintenance.split('T')[0] || new Date(item.lastMaintenance).toISOString().split('T')[0]
            });
            setCurrentView('edit');
          };

          const saveEdit = () => {
            if (!editingItem.name || !editingItem.lastMaintenance || !editingItem.intervalDays) return;

            const updatedItem = {
              ...editingItem,
              intervalDays: parseInt(editingItem.intervalDays),
              nextMaintenance: getNextMaintenanceDate(editingItem.lastMaintenance, editingItem.intervalDays)
            };

            setItems(items.map(item => item.id === editingItem.id ? updatedItem : item));
            setEditingItem(null);
            setCurrentView('list');
          };

          const markAsDone = (id) => {
            setItems(items.map(item => {
              if (item.id === id) {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                const currentTime = now.toLocaleTimeString('fr-FR', { 
                  hour: '2-digit', 
                  minute: '2-digit' 
                });
                
                const updatedItem = {
                  ...item,
                  lastMaintenance: today,
                  lastMaintenanceTime: currentTime,
                  nextMaintenance: getNextMaintenanceDate(today, item.intervalDays)
                };
                
                setJustCompleted(id);
                setTimeout(() => setJustCompleted(null), 2000);
                
                return updatedItem;
              }
              return item;
            }));
          };

          const deleteItem = (id) => {
            setItems(items.filter(item => item.id !== id));
            setShowDeleteConfirm(null);
          };

          const filteredItems = items.filter(item => {
            if (filter === 'all') return true;
            if (filter === 'urgent') {
              const status = getStatus(item.nextMaintenance);
              return status === 'overdue' || status === 'urgent';
            }
            return item.category === filter;
          });

          const getStatusColor = (status) => {
            switch (status) {
              case 'overdue': return 'text-red-600 bg-red-50 border-red-200';
              case 'urgent': return 'text-orange-600 bg-orange-50 border-orange-200';
              case 'soon': return 'text-yellow-600 bg-yellow-50 border-yellow-200';
              default: return 'text-green-600 bg-green-50 border-green-200';
            }
          };

          const getStatusText = (status, nextDate) => {
            const today = new Date();
            const diffDays = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));
            
            switch (status) {
              case 'overdue': return `Retard ${Math.abs(diffDays)}j`;
              case 'urgent': return `Dans ${diffDays}j`;
              case 'soon': return `Dans ${diffDays}j`;
              default: return `Dans ${diffDays}j`;
            }
          };

          const urgentCount = items.filter(item => {
            const status = getStatus(item.nextMaintenance);
            return status === 'overdue' || status === 'urgent';
          }).length;

          // Le reste du code identique à l'artifact précédent...
          // [Code complet de l'application mobile]

          return (
            <div className="max-w-md mx-auto bg-gray-50 min-h-screen">
              {/* Header */}
              <div className="bg-blue-600 text-white p-4 flex items-center justify-between sticky top-0 z-50">
                <div className="flex items-center gap-3">
                  {currentView !== 'list' && (
                    <button
                      onClick={() => {
                        setCurrentView('list');
                        setEditingItem(null);
                      }}
                      className="p-1"
                    >
                      <ArrowLeft />
                    </button>
                  )}
                  <Bell />
                  <h1 className="text-lg font-semibold">
                    {currentView === 'add' ? 'Ajouter' : 
                     currentView === 'edit' ? 'Modifier' : 
                     currentView === 'filters' ? 'Filtres' : 
                     'Assistant d\'Entretien'}
                  </h1>
                </div>
                
                {currentView === 'list' && (
                  <div className="flex items-center gap-2">
                    <button
                      onClick={() => setCurrentView('filters')}
                      className="p-2 hover:bg-blue-700 rounded-lg relative"
                    >
                      <Filter />
                      {filter !== 'all' && (
                        <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></div>
                      )}
                    </button>
                    <button
                      onClick={() => setCurrentView('add')}
                      className="p-2 hover:bg-blue-700 rounded-lg"
                    >
                      <Plus />
                    </button>
                  </div>
                )}
              </div>

              {/* Content basé sur la vue actuelle */}
              {currentView === 'list' && (
                <div className="p-4 pb-20">
                  {urgentCount > 0 && (
                    <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                      <div className="flex items-center gap-2 text-red-700">
                        <AlertTriangle />
                        <span className="font-medium">
                          {urgentCount} élément{urgentCount > 1 ? 's' : ''} urgent{urgentCount > 1 ? 's' : ''}
                        </span>
                      </div>
                    </div>
                  )}

                  {filteredItems.length === 0 ? (
                    <div className="text-center py-12">
                      <Clock className="h-16 w-16 text-gray-400 mx-auto mb-4" />
                      <p className="text-gray-500 text-lg mb-2">Aucun élément</p>
                      <p className="text-gray-400">Ajoutez votre premier élément !</p>
                    </div>
                  ) : (
                    <div className="space-y-4">
                      {filteredItems
                        .sort((a, b) => new Date(a.nextMaintenance) - new Date(b.nextMaintenance))
                        .map(item => {
                          const category = categories[item.category];
                          const status = getStatus(item.nextMaintenance);
                          const IconComponent = category.icon;

                          return (
                            <div key={item.id} className={`bg-white rounded-lg shadow-md border-l-4 ${
                              status === 'overdue' ? 'border-red-500' : 
                              status === 'urgent' ? 'border-orange-500' : 
                              status === 'soon' ? 'border-yellow-500' : 'border-green-500'
                            } ${justCompleted === item.id ? 'ring-2 ring-green-300 bg-green-50' : ''}`}>
                              <div className="p-4">
                                <div className="flex items-start justify-between mb-3">
                                  <div className="flex items-center gap-3 flex-1">
                                    <div className={`p-2 rounded-lg ${category.bgClass}`}>
                                      <IconComponent />
                                    </div>
                                    <div className="flex-1 min-w-0">
                                      <h3 className="font-semibold text-gray-800 truncate">{item.name}</h3>
                                      <p className="text-sm text-gray-500">{category.label}</p>
                                    </div>
                                  </div>
                                  <div className="flex gap-1 ml-2">
                                    <button
                                      onClick={() => startEdit(item)}
                                      className="p-2 text-gray-400 hover:text-blue-500 hover:bg-blue-50 rounded-lg"
                                    >
                                      <Edit />
                                    </button>
                                    <button
                                      onClick={() => setShowDeleteConfirm(item.id)}
                                      className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg"
                                    >
                                      <Trash2 />
                                    </button>
                                  </div>
                                </div>

                                <div className={`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium mb-3 border ${getStatusColor(status)}`}>
                                  {status === 'overdue' && <AlertTriangle />}
                                  {status === 'urgent' && <Clock />}
                                  {status === 'ok' && <CheckCircle />}
                                  {getStatusText(status, item.nextMaintenance)}
                                </div>

                                <div className="space-y-1 text-sm text-gray-600 mb-4">
                                  <p>
                                    <span className="font-medium">Dernier:</span>{' '}
                                    {new Date(item.lastMaintenance).toLocaleDateString('fr-FR')}
                                    {item.lastMaintenanceTime && (
                                      <span className="text-green-600 font-medium ml-1">
                                        {item.lastMaintenanceTime}
                                      </span>
                                    )}
                                  </p>
                                  <p>
                                    <span className="font-medium">Prochain:</span>{' '}
                                    {item.nextMaintenance.toLocaleDateString('fr-FR')}
                                  </p>
                                  <p>
                                    <span className="font-medium">Fréquence:</span> {item.intervalDays}j
                                  </p>
                                  {item.notes && (
                                    <p className="text-xs">
                                      <span className="font-medium">Notes:</span> {item.notes}
                                    </p>
                                  )}
                                </div>

                                <button
                                  onClick={() => markAsDone(item.id)}
                                  className={`w-full px-4 py-3 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 font-medium ${
                                    justCompleted === item.id 
                                      ? 'bg-green-700 text-white' 
                                      : 'bg-green-600 text-white hover:bg-green-700 active:bg-green-800'
                                  }`}
                                  disabled={justCompleted === item.id}
                                >
                                  <CheckCircle />
                                  {justCompleted === item.id ? 'Terminé !' : 'Marquer comme fait'}
                                </button>
                              </div>
                            </div>
                          );
                        })
                      }
                    </div>
                  )}
                </div>
              )}

              {/* Modal de confirmation de suppression */}
              {showDeleteConfirm && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-lg p-6 w-full max-w-sm">
                    <h3 className="text-lg font-semibold mb-4">Confirmer la suppression</h3>
                    <p className="text-gray-600 mb-6">
                      Êtes-vous sûr de vouloir supprimer cet élément ?
                    </p>
                    <div className="flex gap-3">
                      <button
                        onClick={() => deleteItem(showDeleteConfirm)}
                        className="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700"
                      >
                        Supprimer
                      </button>
                      <button
                        onClick={() => setShowDeleteConfirm(null)}
                        className="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400"
                      >
                        Annuler
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

       const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<MobileMaintenanceApp />);

        // Service Worker pour PWA
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
              .then((registration) => {
                console.log('SW registered: ', registration);
              })
              .catch((registrationError) => {
                console.log('SW registration failed: ', registrationError);
              });
          });
        }
    </script>
</body>
</html>
